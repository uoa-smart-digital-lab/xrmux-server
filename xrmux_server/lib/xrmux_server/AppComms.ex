defmodule XrmuxServer.AppComms do
    use GenServer

    # ----------------------------------------------------------------------------------------------------
    # ----------------------------------------------------------------------------------------------------
    def start_link(from, appname_atom, message) do
        IO.puts "Starting #{inspect appname_atom}"
        GenServer.start_link(__MODULE__, [from, appname_atom, message])
    end
    # ----------------------------------------------------------------------------------------------------



    # ----------------------------------------------------------------------------------------------------
    # ----------------------------------------------------------------------------------------------------
    @impl true
    def init([from, appname_atom, message]) do
        IO.puts "Initing #{inspect appname_atom}"
        Process.register self(), appname_atom
        {:ok, MapSet.new([from])}
    end
    # ----------------------------------------------------------------------------------------------------



    # ----------------------------------------------------------------------------------------------------
    # Add or remove a websocket PID from the list
    # ----------------------------------------------------------------------------------------------------
    def add_pid_to_appname(state, pid) do
        state |> MapSet.put(pid)
    end

    def remove_pid_from_list(state, pid) do
        state |> MapSet.delete(pid)
    end
    # ----------------------------------------------------------------------------------------------------



    # ----------------------------------------------------------------------------------------------------
    # ----------------------------------------------------------------------------------------------------
    @impl true
    def handle_info(message, state) do
        IO.puts "Message #{inspect message}"
        IO.puts "State #{inspect state}"
        {:noreply, state}
    end
    # ----------------------------------------------------------------------------------------------------
end
